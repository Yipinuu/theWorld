<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" content="是游悠品意的个人站点，现在主要是技术文章和个人作品发表"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="alternative" href="/atom.xml" title="照东方万八千世界" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>照东方万八千世界</title><link rel="stylesheet" href="/css/main.css" type="text/css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--></head><body><header class="head"><h1 class="head-title u-fl"><a href="/">照东方万八千世界</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a href="/" class="head-nav__link">Home</a></li><li class="head-nav__item"><a href="/archives" class="head-nav__link">Archives</a></li><li class="head-nav__item"><a href="http://Lofter.yipinuu.com" class="head-nav__link">Photo</a></li><li class="head-nav__item"><a href="/about.html" class="head-nav__link">About</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time datetime="2015-11-09T16:00:00.000Z" class="post__time">十一月 10, 2015</time><h1 class="post__title"><a href="/2015/RubyGems-capistrano-Practice-notes/">RubyGems Capistrano Practice Notes -- 自动化部署</a></h1></header><div class="post__main echo"><h2 id="前言">前言</h2><p>上一篇文章，写了关于 Ruby 环境的，现在就来说说利用 capistrano 做自动化部署</p>
<h2 id="简单了解_capistrano">简单了解 capistrano</h2><p>capistrano 是为我们做了什么工作呢？</p>
<p>我们通过 capistrano 向远程服务器执行一段设定好的命令。这些命令为我们完成了部署。</p>
<p>简单来尝试一下</p>
<p>在 Gemfile 中加入 capistrano<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem <span class="string">'capistrano'</span>, <span class="string">'~&gt; 3.4.0'</span></span><br></pre></td></tr></table></figure></p>
<p>下载安装并初始化</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bundle install</span><br><span class="line">bundle <span class="built_in">exec</span> <span class="built_in">cap</span> install</span><br></pre></td></tr></table></figure>
<p>初始化命令为我们创建了如下文件</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">├── Capfile</span><br><span class="line">├── config</span><br><span class="line">│   ├── deploy</span><br><span class="line">│   │   ├── production<span class="class">.rb</span></span><br><span class="line">│   │   └── staging<span class="class">.rb</span></span><br><span class="line">│   └── deploy<span class="class">.rb</span></span><br><span class="line">└── lib</span><br><span class="line">    └── capistrano</span><br><span class="line">            └── tasks</span><br></pre></td></tr></table></figure>
<p>那么 capistrano 为我们起到什么作用呢？</p>
<p>config/deploy.rb<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">task <span class="symbol">:hello</span> <span class="keyword">do</span></span><br><span class="line">  puts <span class="string">"Hello world!"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>然后 当你 <code>cap hello</code> 后，会有如下返回信息</p>
<figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">Hello</span> <span class="function_or_atom">world</span><span class="exclamation_mark">!</span></span><br></pre></td></tr></table></figure>
<p>capisttrano 承担的是记录部署需要的命令，当我们使用它进行部署时，它会依照我们设置好的命令来执行。</p>
<p>当然，不仅仅如此，它内含了很丰富的方法。只要简单的设置，就能够达到自动部署的目的。</p>
<h2 id="部署实例">部署实例</h2><p>我们使用的是 capisttrano ＋ unicorn ＋ nginx</p>
<p>在之前的小实验里面，我们是需要输入密码的。在每一次部署都输入密码是一件很麻烦的事。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp <span class="regexp">~/.ssh/</span>id_rsa.pub uuPin1<span class="annotation">@chuxiao</span>.<span class="string">io:</span><span class="regexp">~/.ssh/</span>authorized_keys</span><br></pre></td></tr></table></figure>
<p>通过 SSH 证书，我们将不用再输入密码。<br>如果你已经将公钥上传到了服务器，但还是需要密码时，可以使用<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">ssh</span>-<span class="keyword">add </span>~/.ssh/id_rsa</span><br></pre></td></tr></table></figure></p>
<p>就👌了。</p>
<p>进入远程创建 staging.chuxiao.io 文件夹，并将它的创建者更改为 deployer<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir staging<span class="class">.chuxiao</span><span class="class">.io</span></span><br><span class="line">sudo chown -R staging<span class="class">.chuxiao</span><span class="class">.io</span></span><br></pre></td></tr></table></figure></p>
<p>（PS  不能是 777 权限，会导致 unicorn 无法运行 ）</p>
<p>这是在 Gemfile 中需要加入的<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># an HTTP server for Rack applications</span></span><br><span class="line"><span class="comment"># http://unicorn.bogomips.org/</span></span><br><span class="line">gem <span class="string">'unicorn'</span>, <span class="string">'~&gt; 4.9.0'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Use Capistrano for deployment</span></span><br><span class="line">group <span class="symbol">:development</span> <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># Use Capistrano for deployment</span></span><br><span class="line">  <span class="comment"># http://capistranorb.com/</span></span><br><span class="line">  gem <span class="string">'capistrano'</span>, <span class="string">'~&gt; 3.4.0'</span></span><br><span class="line">  gem <span class="string">'capistrano-rbenv'</span>, <span class="string">'~&gt; 2.0'</span></span><br><span class="line">  gem <span class="string">'capistrano-bundler'</span>, <span class="string">'~&gt; 1.1.4'</span></span><br><span class="line">  gem <span class="string">'capistrano-rails'</span>, <span class="string">'~&gt; 1.1.3'</span></span><br><span class="line">  gem <span class="string">'capistrano-rails-console'</span>, <span class="string">'~&gt; 0.5.2'</span></span><br><span class="line">  gem <span class="string">'capistrano-db-tasks'</span>, <span class="string">'~&gt; 0.4'</span>, <span class="symbol">:require</span> =&gt; <span class="keyword">false</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># https://github.com/tablexi/capistrano3-unicorn</span></span><br><span class="line">  gem <span class="string">'capistrano3-unicorn'</span>, <span class="string">'~&gt; 0.2.1'</span>, <span class="symbol">:require</span> =&gt; <span class="keyword">false</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>下载它们 <code>bundle install</code></p>
<p>初始化 <code>bundle exec cap install</code></p>
<h3 id="配置文件">配置文件</h3><p>仅供参考！</p>
<h4 id="Capfile">Capfile</h4><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'capistrano/setup'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'capistrano/deploy'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'capistrano/rbenv'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'capistrano/bundler'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'capistrano/rails/assets'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'capistrano/rails/migrations'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'capistrano/rails/console'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'capistrano3/unicorn'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'capistrano-db-tasks'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> :db_local_clean, <span class="literal">true</span></span><br><span class="line"><span class="built_in">set</span> :db_remote_clean, <span class="literal">true</span></span><br><span class="line"><span class="built_in">set</span> :assets_dir, %w(<span class="keyword">public</span>/assets <span class="keyword">public</span>/att)</span><br><span class="line"><span class="built_in">set</span> :local_assets_dir, %w(<span class="keyword">public</span>/assets <span class="keyword">public</span>/att)</span><br><span class="line"><span class="built_in">set</span> :disallow_pushing, <span class="literal">true</span></span><br><span class="line"><span class="built_in">set</span> :compress<span class="subst">or</span>, :bzip2</span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">'whenever/capistrano'</span></span><br><span class="line">Dir<span class="built_in">.</span>glob(<span class="string">'lib/capistrano/tasks/*.rake'</span>)<span class="built_in">.</span>each &#123; |r| <span class="keyword">import</span> r &#125;</span><br></pre></td></tr></table></figure>
<h4 id="config/deploy-rb">config/deploy.rb</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">lock <span class="string">'3.4.0'</span></span><br><span class="line"></span><br><span class="line">set <span class="symbol">:application</span>, <span class="string">'Chuxiao'</span></span><br><span class="line">set <span class="symbol">:repo_url</span>, <span class="string">'git@github.com:uuPin1/chuxiao.io.git'</span></span><br><span class="line">set <span class="symbol">:whenever_identifier</span>, -&gt;&#123; <span class="string">"<span class="subst">#&#123;fetch(<span class="symbol">:application</span>)&#125;</span>_<span class="subst">#&#123;fetch(<span class="symbol">:stage</span>)&#125;</span>"</span> &#125;</span><br><span class="line">set <span class="symbol">:scm</span>, <span class="symbol">:git</span></span><br><span class="line">set <span class="symbol">:stage</span>, <span class="symbol">:staging</span></span><br><span class="line">set <span class="symbol">:log_level</span>, <span class="symbol">:info</span></span><br><span class="line">set <span class="symbol">:linked_files</span>, fetch(<span class="symbol">:linked_files</span>, []).push(<span class="string">'config/database.yml'</span>, <span class="string">'config/secrets.yml'</span>)</span><br><span class="line">set <span class="symbol">:linked_dirs</span>, fetch(<span class="symbol">:linked_dirs</span>, []).push(<span class="string">'log'</span>, <span class="string">'tmp/pids'</span>, <span class="string">'tmp/docusign'</span>, <span class="string">'tmp/cache'</span>, <span class="string">'tmp/sockets'</span>, <span class="string">'vendor/bundle'</span>, <span class="string">'public/system'</span>, <span class="string">'public/uploads'</span>)</span><br><span class="line">set <span class="symbol">:keep_releases</span>, <span class="number">5</span></span><br><span class="line"></span><br><span class="line">namespace <span class="symbol">:deploy</span> <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">  desc <span class="string">'Restart application'</span></span><br><span class="line">  task <span class="symbol">:restart</span> <span class="keyword">do</span></span><br><span class="line">    on roles(<span class="symbol">:app</span>), <span class="symbol">in:</span> <span class="symbol">:sequence</span>, <span class="symbol">wait:</span> <span class="number">5</span> <span class="keyword">do</span></span><br><span class="line">      <span class="comment"># Your restart mechanism here, for example:</span></span><br><span class="line">      execute <span class="symbol">:touch</span>, release_path.join(<span class="string">'tmp/restart.txt'</span>)</span><br><span class="line"></span><br><span class="line">      invoke <span class="string">'unicorn:restart'</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  after <span class="symbol">:publishing</span>, <span class="symbol">:restart</span></span><br><span class="line"></span><br><span class="line">  after <span class="symbol">:restart</span>, <span class="symbol">:clear_cache</span> <span class="keyword">do</span></span><br><span class="line">    on roles(<span class="symbol">:web</span>), <span class="symbol">in:</span> <span class="symbol">:groups</span>, <span class="symbol">limit:</span> <span class="number">3</span>, <span class="symbol">wait:</span> <span class="number">10</span> <span class="keyword">do</span></span><br><span class="line">      <span class="comment"># Here we can do anything such as:</span></span><br><span class="line">      <span class="comment"># within release_path do</span></span><br><span class="line">      <span class="comment">#   execute :rake, 'cache:clear'</span></span><br><span class="line">      <span class="comment"># end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  desc <span class="string">'Visit the app'</span></span><br><span class="line">  task <span class="symbol">:visit_web</span> <span class="keyword">do</span></span><br><span class="line">    system <span class="string">"open <span class="subst">#&#123;fetch(<span class="symbol">:app_url</span>)&#125;</span>"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  after <span class="symbol">:deploy</span>, <span class="string">"deploy:visit_web"</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">namespace <span class="symbol">:remote</span> <span class="keyword">do</span></span><br><span class="line">  desc <span class="string">"run rake task, usage: `cap staging remote:rake task='db:create'` "</span></span><br><span class="line">  task <span class="symbol">:rake</span> <span class="keyword">do</span></span><br><span class="line">    on primary(<span class="symbol">:app</span>) <span class="keyword">do</span></span><br><span class="line">      within release_path <span class="keyword">do</span></span><br><span class="line">        with <span class="symbol">rails_env:</span> fetch(<span class="symbol">:rails_env</span>) <span class="keyword">do</span></span><br><span class="line">          info <span class="string">"run `rake <span class="subst">#&#123;<span class="constant">ENV[</span><span class="string">'task'</span>]&#125;</span>`"</span></span><br><span class="line">          <span class="comment"># inspired by https://github.com/capistrano/capistrano/issues/807</span></span><br><span class="line">          execute <span class="symbol">:rake</span>, <span class="constant">ENV[</span><span class="string">'task'</span>]</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  desc <span class="string">"run rake task, usage: `cap staging remote:run command='pwd'` "</span></span><br><span class="line">  task <span class="symbol">:run</span> <span class="keyword">do</span></span><br><span class="line">    on primary(<span class="symbol">:app</span>) <span class="keyword">do</span></span><br><span class="line">      within release_path <span class="keyword">do</span></span><br><span class="line">        with <span class="symbol">rails_env:</span> fetch(<span class="symbol">:rails_env</span>) <span class="keyword">do</span></span><br><span class="line">          info <span class="string">"run `run <span class="subst">#&#123;<span class="constant">ENV[</span><span class="string">'command'</span>]&#125;</span>`"</span></span><br><span class="line">          <span class="comment"># inspired by https://github.com/capistrano/capistrano/issues/807</span></span><br><span class="line">          execute <span class="constant">ENV[</span><span class="string">'command'</span>]</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  desc <span class="string">"tail rails logs, usage: `cap staging remove:tail_log file=unicorn`"</span></span><br><span class="line">  task <span class="symbol">:tail_log</span> <span class="keyword">do</span></span><br><span class="line">    on roles(<span class="symbol">:app</span>) <span class="keyword">do</span></span><br><span class="line">      with_verbosity <span class="constant">Logger:</span><span class="symbol">:DEBUG</span> <span class="keyword">do</span></span><br><span class="line">        log_file = <span class="constant">ENV[</span><span class="string">'file'</span>] || fetch(<span class="symbol">:rails_env</span>)</span><br><span class="line">        execute <span class="string">"tail -f <span class="subst">#&#123;shared_path&#125;</span>/log/<span class="subst">#&#123;log_file&#125;</span>.log"</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># available output verbosity: ['Logger::DEBUG' 'Logger::INFO' 'Logger::ERROR' 'Logger::WARN']</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">with_verbosity</span></span>(output_verbosity)</span><br><span class="line">    old_verbosity = <span class="constant">SSHKit.</span>config.output_verbosity</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="constant">SSHKit.</span>config.output_verbosity = output_verbosity</span><br><span class="line">      yield</span><br><span class="line">    <span class="keyword">ensure</span></span><br><span class="line">      <span class="constant">SSHKit.</span>config.output_verbosity = old_verbosity</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h4 id="config/deply/staging-rb">config/deply/staging.rb</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server <span class="string">'staging.chuxiao.io'</span>, <span class="symbol">user:</span> <span class="string">'deployer'</span>, <span class="symbol">roles:</span> <span class="string">%w&#123;app db web&#125;</span></span><br><span class="line">set <span class="symbol">:app_url</span>, <span class="string">"http://staging.chuxiao.io"</span></span><br><span class="line">set <span class="symbol">:deploy_to</span>, <span class="string">"/var/www/staging.chuxiao.io"</span></span><br><span class="line">set <span class="symbol">:rbenv_type</span>, <span class="symbol">:deployer</span> <span class="comment"># or :system, depends on your rbenv setup</span></span><br><span class="line">set <span class="symbol">:rbenv_ruby</span>, <span class="string">'2.0.0-p643'</span></span><br><span class="line"><span class="comment"># in case you want to set ruby version from the file:</span></span><br><span class="line"><span class="comment"># set :rbenv_ruby, File.read('.ruby-version').strip</span></span><br><span class="line">set <span class="symbol">:rbenv_prefix</span>, <span class="string">"RBENV_ROOT=<span class="subst">#&#123;fetch(<span class="symbol">:rbenv_path</span>)&#125;</span> RBENV_VERSION=<span class="subst">#&#123;fetch(<span class="symbol">:rbenv_ruby</span>)&#125;</span> <span class="subst">#&#123;fetch(<span class="symbol">:rbenv_path</span>)&#125;</span>/bin/rbenv exec"</span></span><br><span class="line">set <span class="symbol">:rbenv_map_bins</span>, <span class="string">%w&#123;rake gem bundle ruby rails&#125;</span></span><br><span class="line">set <span class="symbol">:rbenv_roles</span>, <span class="symbol">:all</span> <span class="comment"># default value</span></span><br><span class="line">set <span class="symbol">:rails_env</span>, <span class="string">"staging"</span></span><br><span class="line">set <span class="symbol">:branch</span>, <span class="string">"develop"</span></span><br></pre></td></tr></table></figure>
<h4 id="config/unicorn/staging-rb">config/unicorn/staging.rb</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">app_path = <span class="constant">File.</span>expand_path(<span class="string">"../../.."</span>, <span class="constant">__FILE__)</span></span><br><span class="line"></span><br><span class="line">working_directory <span class="string">"<span class="subst">#&#123;app_path&#125;</span>"</span></span><br><span class="line">pid               <span class="string">"<span class="subst">#&#123;app_path&#125;</span>/tmp/pids/unicorn.pid"</span></span><br><span class="line"></span><br><span class="line">listen <span class="string">"<span class="subst">#&#123;app_path&#125;</span>/tmp/sockets/unicorn_chuxiao.sock"</span>, <span class="symbol">:backlog</span> =&gt; <span class="number">64</span></span><br><span class="line">listen <span class="number">8001</span>, <span class="symbol">:tcp_nopush</span> =&gt; <span class="keyword">false</span></span><br><span class="line"></span><br><span class="line">stderr_path <span class="string">"log/unicorn.log"</span></span><br><span class="line">stdout_path <span class="string">"log/unicorn_error.log"</span></span><br><span class="line"></span><br><span class="line">worker_processes <span class="number">1</span></span><br><span class="line"></span><br><span class="line">before_exec <span class="keyword">do</span> |server|</span><br><span class="line">  <span class="constant">ENV[</span><span class="string">'BUNDLE_GEMFILE'</span>] = <span class="string">"<span class="subst">#&#123;app_path&#125;</span>/Gemfile"</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">preload_app <span class="keyword">true</span></span><br><span class="line">timeout <span class="number">180</span></span><br><span class="line">rails_env = <span class="string">'staging'</span></span><br><span class="line"></span><br><span class="line">before_fork <span class="keyword">do</span> |server, worker|</span><br><span class="line">  if <span class="keyword">defined</span>?(<span class="constant">ActiveRecord:</span><span class="symbol">:Base</span>)</span><br><span class="line">    <span class="constant">ActiveRecord:</span><span class="symbol">:Base</span>.connection.disconnect!</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  old_pid = <span class="string">"<span class="subst">#&#123;server.config[<span class="symbol">:pid</span>]&#125;</span>.oldbin"</span></span><br><span class="line">  if <span class="constant">File.</span>exists?(old_pid) &amp;&amp; server.pid != old_pid</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="constant">Process.</span>kill(<span class="string">"QUIT"</span>, <span class="constant">File.</span>read(old_pid).to_i)</span><br><span class="line">    rescue <span class="constant">Errno:</span><span class="symbol">:ENOENT</span>, <span class="constant">Errno:</span><span class="symbol">:ESRCH</span></span><br><span class="line">      <span class="comment"># someone else did our job for us</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">after_fork <span class="keyword">do</span> |server, worker|</span><br><span class="line">  if <span class="keyword">defined</span>?(<span class="constant">ActiveRecord:</span><span class="symbol">:Base</span>)</span><br><span class="line">    <span class="constant">ActiveRecord:</span><span class="symbol">:Base</span>.establish_connection</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h4 id="nginx-conf">nginx.conf</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">upstream</span> unicorn &#123;</span><br><span class="line">  <span class="title">server</span> <span class="url">unix:/var/www/staging.chuxiao.io/current/tmp/sockets/unicorn_chuxiao.sock</span> fail_timeout=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">server</span> &#123;</span><br><span class="line">  <span class="title">listen</span> <span class="number">8001</span>; <span class="comment"># for Linux</span></span><br><span class="line">  <span class="title">server_name</span> staging.chuxiao.io;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># path for static files</span></span><br><span class="line">  <span class="title">root</span> /var/www/staging.chuxiao.io/current/public;</span><br><span class="line">  <span class="title">access_log</span> /var/www/staging.chuxiao.io/nginx_access.log;</span><br><span class="line">  <span class="title">error_log</span> /var/www/staging.chuxiao.io/nginx_error.log;</span><br><span class="line">  <span class="title">rewrite_log</span> <span class="built_in">on</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title">location</span><span class="regexp"> ^~</span> /assets/ &#123;</span><br><span class="line">    <span class="title">gzip_static</span> <span class="built_in">on</span>;</span><br><span class="line">    <span class="title">expires</span> max;</span><br><span class="line">    <span class="title">add_header</span> Cache-Control public;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title">try_files</span> <span class="variable">$uri</span>/index.html <span class="variable">$uri</span> <span class="variable">@unicorn</span>;</span><br><span class="line">  <span class="title">location</span> <span class="variable">@unicorn</span> &#123;</span><br><span class="line">    <span class="title">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    <span class="title">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line">    <span class="title">proxy_redirect</span> <span class="built_in">off</span>;</span><br><span class="line">    <span class="title">proxy_pass</span> <span class="url">http://unicorn</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title">error_page</span> <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /<span class="number">500</span>.html;</span><br><span class="line">  <span class="title">client_max_body_size</span> <span class="number">4G</span>;</span><br><span class="line">  <span class="title">keepalive_timeout</span> <span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cap</span> staging deploy</span><br></pre></td></tr></table></figure></p>
<p>现在的话可以根据 Capistrano 的报错进行修改。</p>
<p>在没有报错的情况下，网站还是不正常显示，那么有可能是 unicorn 出错了，还有 nginx 没有重启。</p>
<p>检查 current 中的 log 文件。</p>
<h2 id="后续">后续</h2><p>结合官方 <a href="http://capistranorb.com/" target="_blank" rel="external">capistrano</a> 的文档，不要仅仅只是复制粘贴。</p>
</div><footer class="post__foot u-cf"><a href="/2015/RubyGems-capistrano-Practice-notes/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2015-11-04T16:00:00.000Z" class="post__time">十一月 5, 2015</time><h1 class="post__title"><a href="/2015/deploy-ruby-production/">从头开始，部署 Ruby 环境！</a></h1></header><div class="post__main echo"><h2 id="前言">前言</h2><p>当我们新买好一个服务器时，要经历过哪些大山才能成功部署好 Ruby 的“生存环境”呢？</p>
<h2 id="步骤">步骤</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="built_in">get</span> -<span class="keyword">y</span> <span class="keyword">update</span></span><br><span class="line">apt-<span class="built_in">get</span> -<span class="keyword">y</span> install curl git-core <span class="keyword">python</span>-software-properties</span><br></pre></td></tr></table></figure>
<h3 id="nginx">nginx</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">add</span>-apt-repository <span class="keyword">pp</span><span class="variable">a:nginx</span>/stable</span><br><span class="line">apt-<span class="built_in">get</span> -<span class="keyword">y</span> <span class="keyword">update</span></span><br><span class="line">apt-<span class="built_in">get</span> -<span class="keyword">y</span> install nginx</span><br><span class="line">service nginx start</span><br></pre></td></tr></table></figure>
<h3 id="PostgreSQL">PostgreSQL</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">add-apt-repository ppa:pitti/postgresql</span><br><span class="line">apt-get -y <span class="operator"><span class="keyword">update</span></span><br><span class="line">apt-<span class="keyword">get</span> -y <span class="keyword">install</span> postgresql libpq-dev</span><br><span class="line">sudo -u postgres psql</span><br><span class="line"># \<span class="keyword">password</span></span><br><span class="line"># <span class="keyword">create</span> <span class="keyword">user</span> blog <span class="keyword">with</span> <span class="keyword">password</span> <span class="string">'secret'</span>;</span></span><br><span class="line"># <span class="operator"><span class="keyword">create</span> <span class="keyword">database</span> blog_production owner blog;</span></span><br><span class="line"># \q</span><br></pre></td></tr></table></figure>
<h3 id="Mysql">Mysql</h3><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install mysql-<span class="keyword">server</span> mysql-<span class="keyword">common</span> mysql-<span class="keyword">client</span> libmysqlclient-dev</span><br></pre></td></tr></table></figure>
<h3 id="Postfix">Postfix</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="keyword">get</span> -y install telnet <span class="keyword">postfix</span></span><br></pre></td></tr></table></figure>
<h3 id="Node-js">Node.js</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">add</span>-apt-repository <span class="keyword">pp</span><span class="variable">a:chris</span>-lea/node.js</span><br><span class="line">apt-<span class="built_in">get</span> -<span class="keyword">y</span> <span class="keyword">update</span></span><br><span class="line">apt-<span class="built_in">get</span> -<span class="keyword">y</span> install nodejs</span><br></pre></td></tr></table></figure>
<h3 id="Add_deployer_user">Add deployer user</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adduser deployer --ingroup sudo</span><br><span class="line"><span class="keyword">su</span> deployer</span><br><span class="line"><span class="keyword">cd</span></span><br></pre></td></tr></table></figure>
<h3 id="Ruby_with_rbenv">Ruby with rbenv</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl https:<span class="comment">//raw.githubusercontent.com/fesplugas/rbenv-installer/master/bin/rbenv-installer | bash</span></span><br><span class="line">vim <span class="class">.bashrc</span> <span class="hexcolor">#add</span> rbenv to the <span class="attribute">top</span></span><br><span class="line">. <span class="class">.bashrc</span></span><br><span class="line">sudo apt-get install build-essential libssl-dev libpcre3-dev libncurses5-dev libreadline6-dev libreadline-dev</span><br><span class="line">rbenv install <span class="number">2.0</span>.<span class="number">0</span>-p643</span><br><span class="line">rbenv global <span class="number">2.0</span>.<span class="number">0</span>-p643</span><br><span class="line">gem install bundler --no-ri --no-rdoc</span><br><span class="line">rbenv rehash</span><br></pre></td></tr></table></figure>
<h3 id="Get_to_know_git">Get to know git</h3><p>ssh-keygen -C “your-email-address”<br>cat .ssh/id_rsa.pub<br>ssh git@github.com<br>ssh git@git.coding.net</p>
<h2 id="最后">最后</h2><p>现在服务器已经可以安装好Ruby的环境了。接下来我们会利用 Cap 对 App 进行自动化部署。</p>
</div><footer class="post__foot u-cf"><a href="/2015/deploy-ruby-production/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2015-11-03T16:00:00.000Z" class="post__time">十一月 4, 2015</time><h1 class="post__title"><a href="/2015/Rails-check-box-tag/">RailsForm Check_box_tag -- 当 Product 需要选择多个 Category 时</a></h1></header><div class="post__main echo"><h2 id="前言">前言</h2><p>这是 RailsForm 的一个系列笔记，都会很短小。这是第一篇。</p>
<h2 id="check_box_tag">check_box_tag</h2><p>Model<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">category.rb</span><br><span class="line"></span><br><span class="line">has_and_belongs_to_many <span class="symbol">:products</span></span><br></pre></td></tr></table></figure></p>
<p>HTML<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">%</span> <span class="attribute">Category.all.each</span> <span class="attribute">do</span> |<span class="attribute">category</span>| %&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">%=</span> <span class="attribute">check_box_tag</span> "<span class="attribute">product</span>[<span class="attribute">category_ids</span>][]", <span class="attribute">category.id</span>,</span><br><span class="line">  @<span class="attribute">product.category_ids.include</span>?(<span class="attribute">category.id</span>), <span class="attribute">id:</span> <span class="attribute">dom_id</span>(<span class="attribute">category</span>) %&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">%=</span> <span class="attribute">label_tag</span> <span class="attribute">dom_id</span>(<span class="attribute">category</span>), <span class="attribute">category.name</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">%</span> <span class="attribute">end</span>  %&gt;</span></span><br></pre></td></tr></table></figure></p>
</div><footer class="post__foot u-cf"><a href="/2015/Rails-check-box-tag/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2015-11-03T16:00:00.000Z" class="post__time">十一月 4, 2015</time><h1 class="post__title"><a href="/2015/Rails-content-tag/">Rails Content_tag -- 提示信息</a></h1></header><div class="post__main echo"><h2 id="content_tag">content_tag</h2><figure class="highlight erb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span>&lt;%<span class="ruby"> flash.each <span class="keyword">do</span> |key, msg| </span>%&gt;<span class="xml"></span><br><span class="line">  </span>&lt;%=<span class="ruby"> content_tag <span class="symbol">:div</span>, msg, <span class="symbol">:id</span> =&gt; key </span>%&gt;<span class="xml"></span><br><span class="line"></span>&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<p>等同于</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span>&lt;%<span class="ruby"> <span class="keyword">unless</span> flash[<span class="symbol">:notice</span>].<span class="keyword">nil</span>? </span>%&gt;<span class="xml"></span><br><span class="line">  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"notice"</span>&gt;</span></span>&lt;%=<span class="ruby"> flash[<span class="symbol">:notice</span>] </span>%&gt;<span class="xml"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"error"</span>&gt;</span></span>&lt;%=<span class="ruby"> flash[<span class="symbol">:error</span>] </span>%&gt;<span class="xml"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span>&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/plataformatec/simple_form" target="_blank" rel="external">simple_form “Forms made easy for Rails! It’s tied to a simple DSL, with no opinion on markup.”</a></p>
</div><footer class="post__foot u-cf"><a href="/2015/Rails-content-tag/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2015-10-28T16:00:00.000Z" class="post__time">十月 29, 2015</time><h1 class="post__title"><a href="/2015/Handle-overflow-text/">处理溢出的文字</a></h1></header><div class="post__main echo"><h2 id="前言">前言</h2><p>基于设计的统一性，我们经常会遇到文字溢出导致的问题。</p>
<h2 id="讲解">讲解</h2><p>我们将用到 text-overflow、 white-space、overflow 这几个 CSS 属性。</p>
<h3 id="text-overflow">text-overflow</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">clip</span>: <span class="string">       默认值。不显示省略标记(...)，而是最简单的裁切。</span></span><br><span class="line"><span class="attribute">ellipsis</span>: <span class="string">   当对象文本溢出时显示省略标记(...)。</span></span><br></pre></td></tr></table></figure>
<h3 id="white-space">white-space</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">white-space  属性设置如何处理元素内的空白。</span><br><span class="line"><span class="string">normal:</span>      默认。空白会被浏览器忽略。文本自动处理换行。假如抵达容器边界内容会转到下一行。</span><br><span class="line"><span class="string">pre:</span>         空白会被浏览器保留。其行为方式类似 HTML 中的 &lt;pre&gt; 标签。</span><br><span class="line"><span class="string">nowrap:</span>      文本不会换行，文本会在在同一行上继续，直到遇到 &lt;br&gt; 标签为止。</span><br><span class="line">pre-<span class="string">wrap:</span>    保留空白符序列，但是正常地进行换行。</span><br><span class="line">pre-<span class="string">line:</span>    合并空白符序列，但是保留换行符。</span><br><span class="line"><span class="string">inherit:</span>     规定应该从父元素继承 white-space 属性的值。</span><br></pre></td></tr></table></figure>
<h3 id="overflow">overflow</h3><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">overflow    属性规定当内容溢出元素框时发生的事情。</span><br><span class="line"><span class="label">visible:</span>    默认值。内容不会被修剪，会呈现在元素框之外。假如显式声明此默认值，对象将以包含对象的 window 或 frame 的尺寸裁切。并且 clip 属性设置将失效。</span><br><span class="line"><span class="label">hidden:</span>     内容会被修剪，并且其余内容是不可见的。</span><br><span class="line"><span class="label">scrol:</span>      总是显示滚动条。</span><br><span class="line"><span class="label">auto:</span>       在必需时对象内容才会被裁切或显示滚动条。</span><br><span class="line"><span class="label">inherit:</span>    规定应该从父元素继承 overflow 属性的值。</span><br></pre></td></tr></table></figure>
<h2 id="实现">实现</h2><h3 id="CSS">CSS</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.name</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">50px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">white-space</span>:<span class="value"> nowrap</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">overflow</span>:<span class="value"> hidden</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">text-overflow</span>:<span class="value"> ellipsis</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="HTML">HTML</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">p</span> <span class="attribute">class</span>=<span class="value">"name"</span>&gt;</span>我今天见到了一块钱，我真的很开心。难得运气这么好，但是我却把它送给了邻居小芳，因为她很可爱。<span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Jquery">Jquery</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  $(<span class="string">".name"</span>).hover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="keyword">this</span>).css(<span class="string">"white-space"</span>, <span class="string">"normal"</span>);</span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="keyword">this</span>).css(<span class="string">"white-space"</span>, <span class="string">"nowrap"</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</div><footer class="post__foot u-cf"><a href="/2015/Handle-overflow-text/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article></main><footer class="foot"><div class="foot-copy u-fl">&copy; 2015 游悠品意</div><menu class="page-menu u-fr"><li class="page-menu__item"><span title="Previous" class="page-menu__link icon-arrow-left page-menu__link--disabled"></span></li><li class="page-menu__item"><a title="Next" href="/page/2/" class="page-menu__link icon-arrow-right"></a></li></menu></footer><script>(function(h,g,l,k,j,i){j=h.createElement(g),i=h.getElementsByTagName(g)[0],
j.src="//"+l+".disqus.com/"+k+".js",i.parentNode.insertBefore(j,i)})
(document,"script","yipinuu","count");
</script></body></html>